{% extends 'app_general/components/base.html' %}

{% block site_title %}
  Dashboard | {{ user.username }}
{% endblock %}

{% block content %}
<section class="content-section content-section-single">
  <div class="content-container content-container-narrow">

    <h2 class="content-title">Your Photos</h2>




  {% if user_photos %}
    <div class="photo-gallery">

      {% for photo in user_photos %}
      <div class="photo-item">
        <img src="{{ photo.image }}" alt="Photo taken with {{ photo.camera.name }}" />

        <div class="photo-info">
          <p><strong>Taken with: {{ photo.camera.name }}</strong></p>
          <p class="photo-date"><strong>Date: {{ photo.timestamp|date:"F j, Y" }}</strong></p>
        </div>


        <div style="margin-top: -5px; padding-bottom: 10px;">
          <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û -->
           <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏õ‡∏¥‡∏î‡∏ü‡∏≠‡∏£‡πå‡∏° Popup -->
           <button class="btn btn-download" onclick="openPopup({{ photo.id }})">
            <i class="fa fa-cloud-download" style="margin-right: 5px;"></i> Download
          </button>

          <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏•‡∏ö‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û -->
          <form method="POST" action="{% url 'delete_photo' photo.id %}" style="display:inline;">
            {% csrf_token %}
            <button type="submit" class="btn btn-delete"><i class="fa fa-trash-o" style="margin-right: 5px;"></i> Delete</button>
          </form>
        </div>

      </div>
    {% endfor %}


  </div>

{% else %}
  <p>No photos uploaded yet.</p>
{% endif %}
</div>


</section>
<!-- Overlay ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏°‡∏∑‡∏î‡∏•‡∏á -->
<div class="popup-overlay"></div>

<!-- Popup Form -->
<div id="downloadPopup" class="popup">
  <div class="popup-content">
    <span class="close-btn" onclick="closePopup()">&times;</span>
    <h3 style="margin-bottom: -10px;">Feedback</h3>
    <form id="downloadForm">
      {% csrf_token %}
      <input type="hidden" id="photo_id" name="photo_id">

      <!-- ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° 3: ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏∂‡∏á‡∏û‡∏≠‡πÉ‡∏à‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà -->
      <div class="emoji-rating-container" style="margin-bottom: 30px;">
        <label><p class="questionlabel"> Rate your experience for location </p></label>
        <div class="emoji-rating">
          <span data-value="1" data-label="Worst">üò° <span class="emoji-label-text">Worst</span></span>
          <span data-value="2" data-label="Dislike">‚òπÔ∏è <span class="emoji-label-text">Dislike</span></span>
          <span data-value="3" data-label="Neutral">üòê <span class="emoji-label-text">Neutral</span></span>
          <span data-value="4" data-label="Good">üôÇ <span class="emoji-label-text">Good</span></span>
          <span data-value="5" data-label="Awesome!">üòÉ <span class="emoji-label-text">Awesome!</span></span>
        </div>
        <input type="hidden" name="location_satisfaction" id="locationSatisfactionInput" required>
      </div>

      <!-- ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° 1: ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏´‡∏•‡∏±‡∏Å‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏°‡∏≤‡πÄ‡∏¢‡∏∑‡∏≠‡∏ô (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏•‡∏≤‡∏¢‡∏Ç‡πâ‡∏≠) -->
      <div class="question">
        <label><p class="questionlabel">What was the main reason for your visit? (You may select more than one)</p></label>
        <div class="custom-checkbox-group" id="reasons_for_visit_group">
            {% for key, value in REASON_CHOICES %}
            <label class="custom-checkbox">
                <input type="checkbox" name="reasons_for_visit" value="{{ key }}">
                <span class="checkmark"></span> {{ value }}
            </label>
            {% endfor %}
        </div>
      </div>

      <!-- ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° 7: ‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏µ‡πà‡∏ß‡∏±‡∏ô (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡∏Ç‡πâ‡∏≠‡πÄ‡∏î‡∏µ‡∏¢‡∏ß) -->
      <div class="question">
        <label><p class="questionlabel">How far in advance did you plan your trip to this place?</p></label>
        <div class="custom-checkbox-group" id="planning_ahead_group">
            {% for key, value in PLANNING_CHOICES %}
            <label class="custom-checkbox">
                <input type="radio" name="planning_ahead" value="{{ key }}">
                <span class="checkmark"></span> {{ value }}
            </label>
            {% endfor %}
        </div>
      </div>

      <!-- ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° 2: ‡∏°‡∏≤‡∏Å‡∏±‡∏ö‡πÉ‡∏Ñ‡∏£ (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡∏Ç‡πâ‡∏≠‡πÄ‡∏î‡∏µ‡∏¢‡∏ß) -->
      <div class="question">
        <label><p class="questionlabel">Who did you travel with on this trip?</p></label>
        <div class="custom-checkbox-group" id="travel_with_group">
            {% for key, value in TRAVEL_WITH_CHOICES %}
            <label class="custom-checkbox">
                <input type="radio" name="travel_with" value="{{ key }}">
                <span class="checkmark"></span> {{ value }}
            </label>
            {% endfor %}
        </div>
      </div>

      <!-- ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° 4: ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà -->
      <div class="comment-container">
        <label><p class="questionlabel"> Your comment for this location (Optional) </p></label>
        <textarea name="location_comment" placeholder="Describe your experience here"></textarea>
      </div>

      <!-- ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° 5: ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏∂‡∏á‡∏û‡∏≠‡πÉ‡∏à‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Elevview -->
      <div style="margin-bottom: 30px;">
        <label><p class="questionlabel"> Rate your experience for Elevview </p></label>
        <div class="emoji-rating">
          <span data-value="1" data-label="Worst">üò° <span class="emoji-label-text">Worst</span></span>
          <span data-value="2" data-label="Dislike">‚òπÔ∏è <span class="emoji-label-text">Dislike</span></span>
          <span data-value="3" data-label="Neutral">üòê <span class="emoji-label-text">Neutral</span></span>
          <span data-value="4" data-label="Good">üôÇ <span class="emoji-label-text">Good</span></span>
          <span data-value="5" data-label="Awesome!">üòÉ <span class="emoji-label-text">Awesome!</span></span>
        </div>
        <input type="hidden" name="elevview_satisfaction" id="satisfactionInput" required>
      </div>

      <!-- ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° 6: ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Elevview -->
      <div class="comment-container">
        <label><p class="questionlabel"> Your comment for Elevview (Optional) </p></label>
        <textarea name="elevview_comment" placeholder="Describe your experience here"></textarea>
      </div>

      

      <button type="submit" class="btnsubmit btn-download">Submit & Download</button>
    </form>
  </div>
</div>

<!-- FontAwesome ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô -->
<!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"> -->

<style>
  /* Gellery */
  .photo-date {
    color: #6c757d;
  }
  .photo-gallery {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    max-width: 90%;
    margin: auto;
  }
  .photo-item {
    border: 1px solid #e0e0e0;
    padding: 0px;
    border-radius:12px;
    text-align: center;
    background-color: #ffffff;
  }
  .photo-item img {
    max-width: 100%;
    height: auto;
    border-radius: 8px;
  }

  .photo-info {
    padding: 0px 30px;
    text-align: left;
  }

  .photo-info strong {
    font-weight: 600;
    font-size: 14px;
  }
  .photo-info p {
    font-weight: 300;
    margin: auto;
    font-size: 14px;
  }

  .btn {
    display: inline-block;
    padding: 8px 18px;
    margin-top: 10px;
    font-size: 14px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    text-decoration: none;
    color: #fff;
    width: 45%;
    margin-left: 5px;
  }
  .btnsubmit {
    display: inline-block;
    padding: 18px 8px;
    margin-top: 10px;
    font-size: 14px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    text-decoration: none;
    color: #fff;
    width: 100%;
  }


  .btn-delete {
    background-color: 	white;
    color: #c22242 ;
    border: solid 1px;
  }




/* ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á Popup */
.popup {
    z-index: 10; /* ‡∏≠‡∏¢‡∏π‡πà‡∏î‡πâ‡∏≤‡∏ô‡∏´‡∏ô‡πâ‡∏≤ Overlay */
    display: none;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: white;
    padding: 25px;
    box-shadow: 0px 4px 15px rgba(0, 0, 0, 0.3);
    width: 370px; /* ‡∏Ç‡∏¢‡∏≤‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á */
    border-radius: 15px; /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡πÇ‡∏Ñ‡πâ‡∏á */
    font-family: 'Arial', sans-serif;
    
    /* ‚úÖ ‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô */
    max-height: 90vh; /* ‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏™‡∏π‡∏á‡πÄ‡∏Å‡∏¥‡∏ô 80% ‡∏Ç‡∏≠‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠ */
    overflow-y: auto; /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á */
}


/* ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á‡∏†‡∏≤‡∏¢‡πÉ‡∏ô Popup */
.popup-content {
    max-width: 90%;
    margin: auto;
    display: flex;
    flex-direction: column;
    gap: 15px;
}

/* ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏°‡∏∑‡∏î (Overlay) */
.popup-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5); /* ‡∏™‡∏µ‡∏î‡∏≥‡πÇ‡∏õ‡∏£‡πà‡∏á‡πÅ‡∏™‡∏á */
    z-index: 9; /* ‡∏≠‡∏¢‡∏π‡πà‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤‡∏ï‡∏±‡∏ß Popup */
}

/* ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á‡∏õ‡∏∏‡πà‡∏°‡∏õ‡∏¥‡∏î */
.close-btn {
    cursor: pointer;
    color: #ff4d4d;
    font-size: 22px;
    font-weight: bold;
    position: absolute;
    top: 12px;
    right: 15px;
    transition: color 0.3s;
}

.close-btn:hover {
    color: #d60000;
}

/* ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á Label */
.popup label {
    font-size: 14px;
    font-weight: bold;
    color: #333;
    margin-bottom: 5px;
    display: block;
}

/* ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á Select (Dropdown) */
.popup select {
    width: 100%;
    padding: 8px;
    font-size: 14px;
    border: 1px solid #ccc;
    border-radius: 8px;
    background: #f9f9f9;
    cursor: pointer;
    transition: border 0.3s;
}

.popup select:focus {
    border-color: #007bff;
    outline: none;
}

/* ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á Textarea */
.popup textarea {
    width: 100%;
    padding: 10px;
    font-size: 14px;
    border: 1px solid #ccc;
    border-radius: 8px;
    background: #f9f9f9;
    resize: vertical;
    transition: border 0.3s;
}

.popup textarea:focus {
    border-color: #007bff;
    outline: none;
}

/* ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á‡∏≠‡∏¥‡πÇ‡∏°‡∏à‡∏¥ Rating */
.emoji-rating {
    display: flex;
    justify-content: space-around;
    font-size: 32px; /* ‡∏Ç‡∏¢‡∏≤‡∏¢‡∏Ç‡∏ô‡∏≤‡∏î‡∏≠‡∏¥‡πÇ‡∏°‡∏à‡∏¥ */
    margin-top: 10px;
    position: relative;
}

/* ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á Emoji */
.emoji-rating span {
    cursor: pointer;
    transition: transform 0.3s, background-color 0.3s;
    padding: 10px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 50px;
    height: 50px;
}

/* ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ñ‡∏π‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏Å */
.emoji-rating span.selected {
    transform: scale(1.5);
    text-shadow: 0px 0px 8px rgba(0, 0, 0, 0.2);
    background-color: #8ebdee; /* ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏™‡∏µ‡∏ü‡πâ‡∏≤ */
    color: white;
}

/* ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏ï‡πâ Emoji */
.emoji-rating .emoji-label-text {
    font-size: 12px;
    font-weight: bold;
    color: transparent; /* ‡∏ã‡πà‡∏≠‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô */
    position: absolute;
    bottom: -32px;
    left: 50%;
    transform: translateX(-50%);
    transition: color 0.3s ease-in-out;
}

/* ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏µ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏ï‡πâ Emoji ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ñ‡∏π‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏Å */
/* ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏µ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏ï‡πâ Emoji ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ñ‡∏π‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏Å */
.emoji-rating span.selected .emoji-label-text {
    color: #b3cce7; /* ‡∏™‡∏µ‡∏ü‡πâ‡∏≤ */
}


/* ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á Textarea */
textarea {
    width: 100%;
    min-height: 120px; /* ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô */
    max-height: 300px; /* ‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á */
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 8px;
    font-size: 16px;
    resize: vertical; /* ‡πÉ‡∏´‡πâ‡∏Ç‡∏¢‡∏≤‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô-‡∏•‡∏á‡πÑ‡∏î‡πâ */
    transition: border-color 0.3s, box-shadow 0.3s;
}
/* ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏µ‡πÄ‡∏™‡πâ‡∏ô‡∏Ç‡∏≠‡∏ö‡πÄ‡∏°‡∏∑‡πà‡∏≠ textarea ‡∏ñ‡∏π‡∏Å‡∏Ñ‡∏•‡∏¥‡∏Å */
textarea:focus {
    border-color: #007BFF;
    box-shadow: 0px 0px 8px rgba(0, 123, 255, 0.3);
    outline: none;
}
/* ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á Placeholder */
textarea::placeholder {
    color: #999;
    font-style: italic;
}

/* ‡∏à‡∏±‡∏î‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° */
.question {
    margin-bottom: 20px;
}

/* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° */
.questionlabel {
    text-align: left; /* ‡∏ä‡∏¥‡∏î‡∏ã‡πâ‡∏≤‡∏¢ */
    font-size: 16px; /* ‡∏ï‡∏±‡∏ß‡πÉ‡∏´‡∏ç‡πà‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢ */
    color: #0e0d0d; /* ‡∏™‡∏µ‡πÄ‡∏Ç‡πâ‡∏°‡∏Ç‡∏∂‡πâ‡∏ô */
    font-weight: bold; /* ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏ï‡∏±‡∏ß‡∏´‡∏ô‡∏≤ */
    margin-bottom: 8px; /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á */
}

/* ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö checkbox */
.custom-checkbox-group {
    display: flex;
    flex-direction: column;
    text-align: left; /* ‡∏à‡∏±‡∏î‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏¥‡∏î‡∏ã‡πâ‡∏≤‡∏¢ */
}

/* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å */
.custom-checkbox {
    display: flex;
    align-items: center;
    position: relative;
    padding: 6px 6px;
    border-bottom: 1px solid #ddd;
    cursor: pointer;
    font-size: 16px;
    align-items: flex-start; /* ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ç‡∏∂‡πâ‡∏ô‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡πÉ‡∏´‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏ï‡πâ‡∏ô‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡πÅ‡∏£‡∏Å */
}

/* ‡∏ã‡πà‡∏≠‡∏ô checkbox ‡∏õ‡∏Å‡∏ï‡∏¥ */
.custom-checkbox input {
    display: none;
}

/* ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡πÑ‡∏ï‡∏•‡πå Checkmark */
.checkmark {
    width: 20px;
    height: 20px;
    border: 2px solid #bbb;
    border-radius: 50%;
    display: inline-block;
    margin-right: 12px;
    position: relative;
}

/* ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å checkbox ‡πÅ‡∏•‡πâ‡∏ß ‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡∏ñ‡∏π‡∏Å */
.custom-checkbox input:checked + .checkmark::after {
    content: "‚úî";
    font-size: 16px;
    color: #007BFF;
    font-weight: bold;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
}

</style>

<script>
document.querySelectorAll(".emoji-rating span").forEach(span => {
    span.addEventListener("click", function() {
        let parent = this.parentElement;

        // Remove 'selected' class from all emojis in the same group
        parent.querySelectorAll("span").forEach(s => s.classList.remove("selected"));

        // Add 'selected' class to clicked emoji
        this.classList.add("selected");

        // Update hidden input based on the emoji selection
        let inputField = parent.nextElementSibling;  // Get the associated hidden input
        inputField.value = this.getAttribute("data-value");

        // Ensure text label updates properly
        parent.querySelectorAll(".emoji-label-text").forEach(label => {
            label.style.color = "transparent"; // Hide other labels
        });

        let labelText = this.querySelector(".emoji-label-text");
        labelText.style.color = "#007BFF"; // Highlight selected label
    });
});

document.getElementById("downloadForm").addEventListener("submit", function(event) {
    event.preventDefault(); // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏´‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö

    let locationRating = document.getElementById("locationSatisfactionInput").value;
    let elevviewRating = document.getElementById("satisfactionInput").value;

    let reasonsChecked = document.querySelectorAll("#reasons_for_visit_group input:checked").length > 0;
    let travelWithChecked = document.querySelector("#travel_with_group input:checked") !== null;
    let planningChecked = document.querySelector("#planning_ahead_group input:checked") !== null;

    if (!locationRating || !elevviewRating || !reasonsChecked || !travelWithChecked || !planningChecked) {
        alert("‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡∏Ç‡πâ‡∏≠‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°!");

        highlightMissingFields(reasonsChecked, travelWithChecked, planningChecked);
        return;
    }

    // **‡∏ñ‡πâ‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ñ‡∏£‡∏ö‡πÅ‡∏•‡πâ‡∏ß ‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ï‡∏≤‡∏°‡∏õ‡∏Å‡∏ï‡∏¥**
    let formData = new FormData(this);
    fetch("{% url 'save_engagement' %}", {
      method: "POST",
      body: formData,
      headers: { "X-CSRFToken": document.querySelector("[name=csrfmiddlewaretoken]").value }
    })
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        closePopup(); // ‡∏õ‡∏¥‡∏î Popup

        setTimeout(() => {
          if (data.download_url) {
            window.location.href = data.download_url; // ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå
          } else {
            alert("Download URL not found!");
          }

          resetForm();  // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ñ‡πà‡∏≤‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à
        }, 500);
      } else {
        alert("‚ùå ‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà!");
      }
    })
    .catch(error => console.error("Error:", error));
});

/** ‚úÖ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÑ‡∏Æ‡πÑ‡∏•‡∏ó‡πå‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å */
function highlightMissingFields(locationRating, elevviewRating) {
    if (!locationRating) {
        document.querySelector(".location-rating").style.border = "2px solid red";
    } else {
        document.querySelector(".location-rating").style.border = "none";
    }

    if (!elevviewRating) {
        document.querySelector(".elevview-rating").style.border = "2px solid red";
    } else {
        document.querySelector(".elevview-rating").style.border = "none";
    }
}


  function openPopup(photoId) {
    document.getElementById("photo_id").value = photoId;
    document.getElementById("downloadPopup").style.display = "block";
    document.querySelector(".popup-overlay").style.display = "block"; // ‡πÅ‡∏™‡∏î‡∏á Overlay
}

function closePopup() {
    document.getElementById("downloadPopup").style.display = "none";
    document.querySelector(".popup-overlay").style.display = "none"; // ‡∏ã‡πà‡∏≠‡∏ô Overlay
}

// ‡∏õ‡∏¥‡∏î Popup ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà Overlay
document.querySelector(".popup-overlay").addEventListener("click", closePopup);

  document.getElementById("downloadForm").addEventListener("submit", function(event) {
    event.preventDefault();

    let formData = new FormData(this);
    fetch("{% url 'save_engagement' %}", {
      method: "POST",
      body: formData,
      headers: { "X-CSRFToken": document.querySelector("[name=csrfmiddlewaretoken]").value }
    })
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        closePopup(); // ‡∏õ‡∏¥‡∏î Popup
        setTimeout(() => {
          if (data.download_url) {
            window.location.href = data.download_url; // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏õ‡∏¥‡∏î URL ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á
          } else {
            alert("Download URL not found!");
          }
          resetForm();  // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ñ‡πà‡∏≤‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à
        }, 500);
      } else {
        alert("Something went wrong!");
      }
    })
    .catch(error => console.error("Error:", error));
});

/** ‚úÖ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏° */
function resetForm() {
    let form = document.getElementById("downloadForm");
    form.reset(); // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ñ‡πà‡∏≤‡πÉ‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏°

    // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ç‡∏≠‡∏á emoji-rating
    document.querySelectorAll(".emoji-rating span").forEach(span => {
        span.classList.remove("selected");
    });

    // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ñ‡πà‡∏≤ Hidden Input ‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡∏ß‡πà‡∏≤‡∏á
    document.getElementById("locationSatisfactionInput").value = "";
    document.getElementById("satisfactionInput").value = "";

    // ‡∏ã‡πà‡∏≠‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
    document.querySelectorAll(".emoji-label-text").forEach(label => {
        label.style.color = "transparent";
    });
}
</script>
{% endblock %}